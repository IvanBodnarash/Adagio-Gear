<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="libs/jquery-ui.min.js"></script>
    <style>
        img {
            width: 150px;
        }

        li {
            margin: 20px;
            width: 250px;
            background-color: #c6c6c6;
            color: wheat;
        }

        .basket {
            width: 150px;
            height: 150px;
            background-color: #661818;
        }

        .active {
            border: red dotted 2px;
        }

        .clear {
            display: flex;
        }
    </style>
</head>

<body>

    <main>
        <section id="product">
            <ul class="clear">
                <li data-id="1">
                    <a href="#">
                        <img src="img/ath-r70x_01.png" alt="">
                        <h3>Lorem ipsum dolor sit.1</h3>
                        <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Maxime dolor officia amet magni
                            asperiores delectus!</p>
                    </a>
                </li>
                <li data-id="2">
                    <a href="#">
                        <img src="img/AMP_BG_BASS.jpg" alt="">
                        <h3>Lorem ipsum dolor sit.2</h3>
                        <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Maxime dolor officia amet magni
                            asperiores delectus!</p>
                    </a>
                </li>
                <li data-id="3">
                    <a href="#">
                        <img src="img/mkii305-pair_z_original.jpg" alt="">
                        <h3>Lorem ipsum dolor sit.3</h3>
                        <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Maxime dolor officia amet magni
                            asperiores delectus!</p>
                    </a>
                </li>
            </ul>
        </section>

        <aside id="sidebar">
            <div class="basket">
                <div class="basket__list">
                    <div class="head">
                        <span class="name">Name</span>
                        <span class="count">Q-ty</span>
                    </div>
                    <ul>
                        <!-- here will be dropped products -->
                    </ul>
                </div>
                <div id="total-price">Total Price: $0</div>
            </div>
        </aside>
    </main>


    <script>
        let productsArr = [
            {
                id: 1,
                name: "Product 1",
                price: 105
            },
            {
                id: 2,
                name: "Product 2",
                price: 250
            },
            {
                id: 3,
                name: "Product 3",
                price: 450
            }
        ]

        $('#product li').draggable({
            revert: true,
            helper: "clone",

            drag: function () {
                $(this).addClass('active');
                $(this).closest('#product').addClass('active');
            },

            stop: function () {
                $(this).removeClass('active').closest('#product').removeClass('active');
            }
        });

        $('.basket').droppable({
            activeClass: 'active',
            hoverClass: 'hover',
            tolerance: 'touch',
            drop: function (event, ui) {
                let basket = $(this),
                    move = ui.draggable,
                    itemId = basket.find("ul li[data-id=' " + move.attr("data-id") + "']");

                if (itemId.html() != null) {
                    itemId.find(".count").text(parseInt(itemId.find(".count").text()) + 1);
                }
                else {
                    addBasket(basket, move);

                    // move.find("input").val(parseInt(move.find("input").val()) + 1);
                }
            }
        });

        function addBasket(basket, move) {
            let productId = move.attr("data-id");
            let product = getProductById(productId);

            let itemId = basket.find("ul li").filter(function () {
                return $(this).attr("data-id") === productId;
            });

            if (itemId.length > 0) {
                let quantityElement = itemId.find(".count");
                let quantity = parseInt(quantityElement.text());
                quantityElement.text(quantity + 1);
            } else {
                var newItem = $('<li data-id="' + productId + '">'
                    + '<span class="name">' + product.name + '</span>'
                    + '<span class="price">$' + product.price + '</span>'
                    + '<p class="count">1</p>'
                    + '<button class="delete">&#10005;</button></li>');

                basket.find("ul").append(newItem);

                newItem.hide().slideDown(500);


                // $("body").on("click", ".basket ul li button.delete", function () {
                //     removeItem($(this).closest(".basket"), $(this).closest("li"));
                // });
            }

            updateTotalPrice(basket);

        }

        function getProductById(productId) {
            let product = productsArr.find(function (item) {
                return item.id == productId;
            });

            return product ? product : { id: 0, name: "", price: 0 };
        }

        function updateTotalPrice(basket) {
            let total = 0;
            basket.find("ul li").each(function () {
                let price = parseInt($(this).find(".price").text().substr(1));
                let quantity = parseInt($(this).find(".count").text());
                total += price * quantity;
            });

            basket.find("#total-price").text("Total Price: $" + total);
        }

        $('.basket ul').on('click', 'li button.delete', function() {
            $(this).closest('li').slideUp(500, function() {
                $(this).remove();
                updateTotalPrice($(this).closest('.basket'));
            });
        });

        // $("body").on("click", ".basket ul li button.delete", function () {
        //     $(this).closest("li").remove();
        // });
    </script>
</body>

</html>